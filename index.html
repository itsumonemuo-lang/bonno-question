<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>煩悩カード</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: "Hiragino Mincho ProN", serif;
  background: url("background.jpg") center / cover no-repeat fixed;
}

#container {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

#card {
  width: 90%;
  max-width: 420px;
  background: url("washi.jpg") center / cover;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 15px 35px rgba(0,0,0,.35);
  text-align: center;
  position: relative;
  overflow: hidden;
}

#card.flip {
  animation: flip 0.6s ease;
}

@keyframes flip {
  0% { transform: rotateY(0); }
  50% { transform: rotateY(90deg); }
  100% { transform: rotateY(0); }
}

#kirari {
  position: absolute;
  inset: 0;
  background: url("kirari.png") center / contain no-repeat;
  opacity: 0;
  pointer-events: none;
}

#kirari.show {
  animation: shine 0.6s ease;
}

@keyframes shine {
  0% { opacity: 0; transform: scale(.8); }
  50% { opacity: .9; transform: scale(1); }
  100% { opacity: 0; transform: scale(1.2); }
}

button {
  padding: 12px 22px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

#question {
  margin-top: 20px;
  font-size: 18px;
  white-space: pre-wrap;
  line-height: 1.7;
}

#count {
  margin-top: 10px;
  font-size: 13px;
  opacity: .7;
}

#share-area {
  display: none;
  margin-top: 22px;
}

.share-x {
  display: inline-block;
  padding: 10px 18px;
  border-radius: 999px;
  background: #000;
  color: #fff;
  text-decoration: none;
  font-size: 14px;
}
</style>
</head>

<body>
<div id="container">
  <div id="card">
    <div id="kirari"></div>

    <h2>今日ひらいた煩悩質問</h2>
    <button onclick="drawCard()">カードをめくる</button>

    <div id="question"></div>
    <div id="count"></div>

    <div id="share-area">
      <a id="share-x" class="share-x" target="_blank">Xでこの煩悩をシェア</a>
    </div>
  </div>
</div>

<audio id="flip-sound" src="flip.mp3"></audio>

<script>
const questions = [
  "Q. 人と比べて苦しくなるのはどんなとき？\n\nA.",
  "Q. 手放したいのに手放せないものは？\n\nA.",
  "Q. 認められたいと思うのはどんな瞬間？\n\nA.",
  "Q. つい見栄を張ってしまうのはどんなとき？\n\nA."
];

let lastIndex = -1;
let count = localStorage.getItem("bonnoCount") || 0;
document.getElementById("count").innerText =
  `あなたで ${count} 回目の質問です`;

function drawCard() {
  let i;
  do {
    i = Math.floor(Math.random() * questions.length);
  } while (i === lastIndex);
  lastIndex = i;

  const card = document.getElementById("card");
  const kirari = document.getElementById("kirari");
  const sound = document.getElementById("flip-sound");

  card.classList.add("flip");
  kirari.classList.add("show");
  sound.currentTime = 0;
  sound.play();

  setTimeout(() => {
    const q = questions[i];
    document.getElementById("question").innerText = q;

    count++;
    localStorage.setItem("bonnoCount", count);
    document.getElementById("count").innerText =
      `あなたで ${count} 回目の質問です`;

    setupShare(q);

    card.classList.remove("flip");
    kirari.classList.remove("show");
    document.getElementById("share-area").style.display = "block";
  }, 300);
}

function setupShare(q) {
  const text =
    "今日ひらいた煩悩質問。\n\n" +
    q +
    "\n\n▼あなたもひらく\n";

  const url = location.href;
  const encoded = encodeURIComponent(text + url);

  document.getElementById("share-x").href =
    `https://twitter.com/intent/tweet?text=${encoded}`;
}
</script>
</body>
</html>

